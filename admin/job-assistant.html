<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Job Assistant — Admin</title>
  <!-- keep it out of search results -->
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root { --bg:#ffffff; --ink:#0b1220; --muted:#6b7280; --dash:#9ca3af; --code:#0f172a; --code-ink:#e2e8f0; }
    body { font:16px system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu; margin:24px; line-height:1.45; color:var(--ink); background:var(--bg); }
    h1 { font-size:28px; margin:0 0 6px; }
    .note { color:var(--muted); font-size:13px; margin-bottom:12px; }
    .gate { padding:20px; border:1px dashed var(--dash); border-radius:10px; max-width:720px; }
    textarea, input, button { font:inherit }
    textarea { width:100%; min-height:140px; margin:8px 0; }
    pre { background:var(--code); color:var(--code-ink); padding:12px; border-radius:8px; overflow:auto; }
    code { word-break: break-all; }
    .btn { display:inline-block; background:#0ea5e9; color:#06202e; border:0; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer; }
    .stack { max-width:900px; }
  </style>
</head>
<body>
  <div class="stack">
    <h1>Job Assistant (v0)</h1>
    <p class="note">Hidden page. Not linked anywhere. Uses a simple key check via URL parameter.</p>

    <!-- Gate shown until the correct key is provided -->
    <div id="gate" class="gate">
      <p><strong>Access</strong> — open with <code>?key=nmmiller1991</code> in the URL.</p>
      <p class="note">Example:<br>
        <code>https://nmillerit.github.io/personal-site/admin/job-assistant.html?key=nmmiller1991</code>
      </p>
    </div>

    <!-- App UI (hidden until unlocked) -->
    <div id="app" style="display:none">
      <h3>1) Paste Resume JSON</h3>
<pre>{
  "basics": {"name":"Your Name","email":"you@email"},
  "skills": [{"name":"Python","keywords":["pandas","sql","fastapi"]}],
  "experience": [{
    "company":"Acme","title":"Data Analyst","start":"2022-03","end":"2024-08",
    "bullets":["Built forecasting pipeline in Python","Cut SLA breaches by 32%"],
    "skills":["Python","SQL","Tableau"]
  }]
}</pre>
      <textarea id="resumeJson" placeholder="Paste your resume JSON here…"></textarea>

      <h3>2) Paste Job Description</h3>
      <textarea id="jd" placeholder="Paste the job description here…"></textarea>

      <p><button id="btnTailor" class="btn">Tailor Resume Bullets</button></p>

      <h3>Output</h3>
      <pre id="out">Ready…</pre>
    </div>
  </div>

  <script>
    /* ===== Simple URL-only key gate =====
       - Key is nmmiller1991
       - Page unlocks only when the URL has ?key=nmmiller1991
    */
    (function gate(){
      const MY_KEY = "nmmiller1991";
      const provided = new URLSearchParams(location.search).get("key") || "";
      if (provided.trim() === MY_KEY) {
        document.getElementById("gate").style.display = "none";
        document.getElementById("app").style.display = "";
      }
    })();

    /* ===== App v0 (no LLM; deterministic) ===== */
    const $ = (id) => document.getElementById(id);
    const tokenize = (t) =>
      (t || "").toLowerCase().replace(/[^a-z0-9+.# ]/g, " ").split(/\s+/).filter(Boolean);

    function parseResume() {
      try { return JSON.parse($("resumeJson").value.trim()); }
      catch { throw new Error("Resume JSON is invalid"); }
    }

    function extractKeywordsFromJD(jd) {
      const tokens = tokenize(jd);
      const stop = new Set(["and","or","with","for","to","of","in","the","a","an","on","at","by"]);
      const tech = new Set([
        "python","javascript","typescript","react","sql","aws","gcp","azure","docker","kubernetes",
        "pandas","fastapi","node","java","c#","cpp","tableau","dbt","airflow","ml","ai","llm"
      ]);
      const must = [], nice = [];
      for (const w of tokens) {
        if (stop.has(w)) continue;
        if (!/^[a-z0-9+.#-]{2,}$/.test(w)) continue;
        (tech.has(w) ? must : nice).push(w);
      }
      const rank = (arr) => {
        const m = new Map();
        arr.forEach(a => m.set(a, (m.get(a) || 0) + 1));
        return [...m.entries()].sort((a,b)=>b[1]-a[1]).map(([k])=>k);
      };
      return { must: rank(must).slice(0,30), nice: rank(nice).slice(0,30) };
    }

    function scoreMatch(resume, jdKeys) {
      const all = new Set();
      (resume.skills || []).forEach(s => {
        if (s.name) all.add(String(s.name).toLowerCase());
        (s.keywords || []).forEach(k => all.add(String(k).toLowerCase()));
      });
      (resume.experience || []).forEach(e =>
        (e.skills || []).forEach(k => all.add(String(k).toLowerCase()))
      );
      const mustHit = jdKeys.must.filter(k => all.has(k));
      const niceHit = jdKeys.nice.filter(k => all.has(k));
      const score = Math.round(
        (mustHit.length*3 + niceHit.length) /
        Math.max(1, jdKeys.must.length*3 + jdKeys.nice.length) * 100
      );
      return { score, mustHit };
    }

    function quantify(text) {
      return text
        .replace(/\b(increased|reduced|cut|improved|boosted)\b(?!.*?\d)/gi, "$1 ~X%")
        .replace(/\b(delivered|launched|built|designed|migrated)\b(?!.*?\d)/gi, "$1 in ~N weeks");
    }

    function tailorBullets(resume, jd) {
      const keys = extractKeywordsFromJD(jd);
      const match = scoreMatch(resume, keys);
      let bullets = [];
      (resume.experience || []).forEach(exp => {
        const base = exp.bullets || [];
        const ranked = base
          .map(b => {
            const t = tokenize(b);
            const weight =
              t.filter(w => keys.must.includes(w)).length*2 +
              t.filter(w => keys.nice.includes(w)).length;
            return { b, weight };
          })
          .sort((a,b)=>b.weight-a.weight)
          .slice(0,3)
          .map(x => x.b);
        ranked.forEach(b => bullets.push("• " + quantify(b)));
      });
      return `ATS match: ${match.score}%\n` +
             `Keywords hit: ${match.mustHit.join(", ")}\n\n` +
             bullets.join("\n");
    }

    $("btnTailor").addEventListener("click", () => {
      try {
        const resume = parseResume();
        const jd = $("jd").value.trim();
        if (!jd) throw new Error("Job description is missing");
        $("out").textContent = tailorBullets(resume, jd);
      } catch (e) {
        $("out").textContent = "⚠ " + e.message;
      }
    });
  </script>
</body>
</html>
